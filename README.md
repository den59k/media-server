# Рабочая версия медиасервера

## Стек

Приложение построено на основе библиотеки MediaSoup. 

Для запуска потребуется выполнить все пункты из этой инструкции: <https://mediasoup.org/documentation/v3/mediasoup/installation/>

## Дизайн

[Архитектура и дизайн](./docs/design.md)

## Использование

[Инструкция по использованию](./docs/usage.md)

## Основные API

[API для работы с медиасервером](./docs/api.md)

## Запуск через Docker

Чтобы собрать контейнер необходимо выполнить команду  
```
docker build -t mediasoup .
```

Собранный контейнер можно запустить со следующими переменными среды:

* PORT=5000 - порт для самого приложения
* ADDRESS=0.0.0.0 - IP адрес для запускаемого приложения. Для запуска в Docker используется не localhost, а именно 0.0.0.0.
* PUBLIC_IP=192.168.0.100 - *внешний* IP адрес сервера. Используется для RTC подключения по UDP/TCP соединению
* RTC_MIN_PORT=10000 - Минимальный RTC порт для ICE, DTLS, RTP, и т.д.
* RTC_MAX_PORT=59999 - Максимальный RTC порт для ICE, DTLS, RTP, и т.д.
* ENABLE_TCP=true - Разрешить подключение к медиасерверу по TCP соединению
* ENABLE_UDP=true - Разрешить подключение к медиасерверу по UDP соединению *(рекомендуется)*
 
Например, для запуска контейнера с UDP портами на 10000-10009 необходимо выполнить команду
```
docker run -d -p 5000:5000 -p 10000-10009:10000-10009 -e "RTC_MAX_PORT=10009" mediasoup
```

Для того, чтобы устройства смогли подключиться к указанным портам между RTC_MIN_PORT и RTC_MAX_PORT, 
необходимо пробросить указанные порты в самой ОС, или указать в PUBLIC_IP IP-адрес Docker.

## Запуск через Docker Compose

В файле docker-compose необходимо также указать RTC_MIN_PORT или RTC_MAX_PORT, а также пробросить необходимые порты.

Для запуска контейнера выполните команду
```
docker-compose up
```